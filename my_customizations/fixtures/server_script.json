[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 12:57:28.046426",
  "module": "Stock",
  "name": "Notification to Quality Manager When RM Moved to QC Under Test",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Stock Entry",
  "script": "# ----------------------------------\n# Notify QC users when RM moved to Under Test\n# ----------------------------------\n\nqc_roles = [\n    \"Quality Manager\",\n    \"BS-Quality Assurance Manager\",\n    \"BS-Quality Control Manager\"\n]\n\n# Check if any item moved to Under Test warehouse\nunder_test = False\nfor d in doc.items:\n    if d.t_warehouse and \"under test\" in d.t_warehouse.lower():\n        under_test = True\n        break\n\nif under_test:\n\n    # Get ENABLED users having QC roles\n    users = frappe.db.sql(\"\"\"\n        SELECT DISTINCT u.name\n        FROM `tabUser` u\n        JOIN `tabHas Role` r ON r.parent = u.name\n        WHERE\n            u.enabled = 1\n            AND r.role IN %(roles)s\n    \"\"\", {\"roles\": qc_roles}, as_dict=True)\n\n    for u in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Raw Material moved to QC – Under Test\",\n            \"email_content\": f\"\"\"\n                <p><b>Stock Entry:</b> {doc.name}</p>\n                <p>Raw Material has been moved to <b>QC Under Test</b>.</p>\n            \"\"\",\n            \"for_user\": u.name,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:03:08.219675",
  "module": "development",
  "name": "Send Notofications on Vehicle In Permission",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vehicle In Permissions",
  "script": "roles_to_notify = [\n    \"Purchase Master Manager\",\n    \"Purchase Manager\",\n    \"Accounts Manager\",\n    \"BS - Accounts Manager\",\n    \"BS - General Manager\"\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\n# Remove disabled users\nusers = frappe.get_all(\n    \"User\",\n    filters={\n        \"name\": [\"in\", role_users],\n        \"enabled\": 1\n    },\n    pluck=\"name\"\n)\n\nif users:\n    # Prepare field details\n    fields_data = []\n    for df in doc.meta.fields:\n        value = doc.get(df.fieldname)\n        if value:\n            fields_data.append(f\"<b>{df.label}</b>: {value}\")\n\n    message = f\"\"\"\n    <h4>New Vehicle In Permission Created</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/vehicle-in-permission/{doc.name}\">Open Document</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Vehicle In Permission Created\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:06:34.383286",
  "module": "development",
  "name": "Send Notofications on Vehicle Out Permission",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vehicle Out Permission",
  "script": "roles_to_notify = [\n    \"Purchase Master Manager\",\n    \"Purchase Manager\",\n    \"Accounts Manager\",\n    \"BS - Accounts Manager\",\n    \"BS - General Manager\"\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\n# Remove disabled users\nusers = frappe.get_all(\n    \"User\",\n    filters={\n        \"name\": [\"in\", role_users],\n        \"enabled\": 1\n    },\n    pluck=\"name\"\n)\n\nif users:\n    # Prepare field details\n    fields_data = []\n    for df in doc.meta.fields:\n        value = doc.get(df.fieldname)\n        if value:\n            fields_data.append(f\"<b>{df.label}</b>: {value}\")\n\n    message = f\"\"\"\n    <h4>New Vehicle Out Permission Created</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/vehicle-out-permission/{doc.name}\">Open Document</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Vehicle Out Permission Created\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:08:27.119565",
  "module": "development",
  "name": "Send Notofications to Gate Manager on Vehicle In Permission Status Change",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vehicle In Permissions",
  "script": "# Run only if status actually changed\nif doc.has_value_changed(\"status\"):\n\n    # Notify only on Approved or Rejected\n    if doc.status in [\"Approved\", \"Rejected\"]:\n\n        gate_manager_role = \"BS - GATE MANAGER\"\n\n        # Get Gate Manager users\n        role_users = frappe.get_all(\n            \"Has Role\",\n            filters={\"role\": gate_manager_role},\n            pluck=\"parent\"\n        )\n\n        # Get enabled users only\n        users = frappe.get_all(\n            \"User\",\n            filters={\n                \"name\": [\"in\", role_users],\n                \"enabled\": 1\n            },\n            pluck=\"name\"\n        )\n\n        if users:\n\n            status_icon = \"✅\" if doc.status == \"Approved\" else \"❌\"\n\n            message = f\"\"\"\n            <h4>{status_icon} Vehicle In Permission {doc.status}</h4>\n            <hr>\n            <b>Document</b>: {doc.name}<br>\n            <b>Status</b>: {doc.status}<br><br>\n            <a href=\"/app/vehicle-in-permission/{doc.name}\">\n            Open Vehicle In Permission\n            </a>\n            \"\"\"\n\n            for user in users:\n                frappe.get_doc({\n                    \"doctype\": \"Notification Log\",\n                    \"subject\": f\"Vehicle In Permission {doc.status}\",\n                    \"email_content\": message,\n                    \"for_user\": user,\n                    \"document_type\": doc.doctype,\n                    \"document_name\": doc.name,\n                    \"type\": \"Alert\"\n                }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:12:51.055236",
  "module": "development",
  "name": "Send Notofications on Visitor In Permission",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Visitor Permission",
  "script": "roles_to_notify = [\n    \"BS - Reception\",\n    \"BS - General Manager\",\n    \"BS- Marketing Manager\",\n    \"Marketing Manager\"\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\n# Remove disabled users\nusers = frappe.get_all(\n    \"User\",\n    filters={\n        \"name\": [\"in\", role_users],\n        \"enabled\": 1\n    },\n    pluck=\"name\"\n)\n\nif users:\n    # Prepare field details\n    fields_data = []\n    for df in doc.meta.fields:\n        value = doc.get(df.fieldname)\n        if value:\n            fields_data.append(f\"<b>{df.label}</b>: {value}\")\n\n    message = f\"\"\"\n    <h4>New Visitor Permission Created</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/visitor-permission/{doc.name}\">Open Document</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Visitor Permission Created\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:14:28.222615",
  "module": "development",
  "name": "Send Notofications on Employee In Permission",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Employee Permission",
  "script": "roles_to_notify = [\n    \"HR Manager\",\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\n# Remove disabled users\nusers = frappe.get_all(\n    \"User\",\n    filters={\n        \"name\": [\"in\", role_users],\n        \"enabled\": 1\n    },\n    pluck=\"name\"\n)\n\nif users:\n    # Prepare field details\n    fields_data = []\n    for df in doc.meta.fields:\n        value = doc.get(df.fieldname)\n        if value:\n            fields_data.append(f\"<b>{df.label}</b>: {value}\")\n\n    message = f\"\"\"\n    <h4>New Employee Permission Created</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/employee-permission/{doc.name}\">Open Document</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Employee Permission Created\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:16:20.233917",
  "module": "development",
  "name": "Send Notofications on Courier In",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Courier In",
  "script": "roles_to_notify = [\n    \"Store Manager -FG\",\n    \"BS - General Manager\",\n    \"BS- Quality Assurance Manager\",\n    \"Quality Manager\",\n    \"BS-Quality Control Manager\"\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\n# Remove disabled users\nusers = frappe.get_all(\n    \"User\",\n    filters={\n        \"name\": [\"in\", role_users],\n        \"enabled\": 1\n    },\n    pluck=\"name\"\n)\n\nif users:\n    # Prepare field details\n    fields_data = []\n    for df in doc.meta.fields:\n        value = doc.get(df.fieldname)\n        if value:\n            fields_data.append(f\"<b>{df.label}</b>: {value}\")\n\n    message = f\"\"\"\n    <h4>New Courier Created</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/courier-in/{doc.name}\">Open Document</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": \"Courier Created\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:19:10.539232",
  "module": "development",
  "name": "Send Notofications to Gate Manager on Vehicle Out Permission Approval",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vehicle Out Permission",
  "script": "# Run only if status actually changed\nif doc.has_value_changed(\"status\"):\n\n    # Notify only on Approved or Rejected\n    if doc.status in [\"Approved\", \"Rejected\"]:\n\n        gate_manager_role = \"BS - GATE MANAGER\"\n\n        # Get Gate Manager users\n        role_users = frappe.get_all(\n            \"Has Role\",\n            filters={\"role\": gate_manager_role},\n            pluck=\"parent\"\n        )\n\n        # Get enabled users only\n        users = frappe.get_all(\n            \"User\",\n            filters={\n                \"name\": [\"in\", role_users],\n                \"enabled\": 1\n            },\n            pluck=\"name\"\n        )\n\n        if users:\n\n            status_icon = \"✅\" if doc.status == \"Approved\" else \"❌\"\n\n            message = f\"\"\"\n            <h4>{status_icon} Vehicle Out Permission {doc.status}</h4>\n            <hr>\n            <b>Document</b>: {doc.name}<br>\n            <b>Status</b>: {doc.status}<br><br>\n            <a href=\"/app/vehicle-out-permission/{doc.name}\">\n            Open Vehicle Out Permission\n            </a>\n            \"\"\"\n\n            for user in users:\n                frappe.get_doc({\n                    \"doctype\": \"Notification Log\",\n                    \"subject\": f\"Vehicle Out Permission {doc.status}\",\n                    \"email_content\": message,\n                    \"for_user\": user,\n                    \"document_type\": doc.doctype,\n                    \"document_name\": doc.name,\n                    \"type\": \"Alert\"\n                }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:20:40.748184",
  "module": "development",
  "name": "Validate Employee In according to permission",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Employee In",
  "script": "if doc.employee_permission:\n\n    # Get allowed number of entries\n    allowed_entries = frappe.db.get_value(\n        \"Employee Permission\",\n        doc.employee_permission,\n        \"no_of_entry_permission\"\n    ) or 0\n    \n        # Convert safely to integer\n    allowed_entries = int(allowed_entries or 0)\n\n    # Proceed only if limit is defined\n    if allowed_entries > 0:\n\n        # Count existing Employee In records\n        used_entries = frappe.db.count(\n            \"Employee In\",\n            {\n                \"employee_permission\": doc.employee_permission\n            }\n        )\n\n        # Validation\n        if used_entries >= allowed_entries:\n            frappe.throw(\n                f\"Entry limit exceeded.<br>\"\n                f\"Allowed entries: {allowed_entries}<br>\"\n                f\"Already used: {used_entries}\"\n            )\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:21:46.920089",
  "module": "Stock",
  "name": "Send Notification on Purchase Recipt Creation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Receipt",
  "script": "roles_to_notify = [\n    \"Purchase Master Manager\",\n    \"Purchase Manager\",\n    \"Accounts Manager\",\n    \"BS - Accounts Manager\",\n    \"BS - General Manager\"\n]\n\n# Get users having these roles\nrole_users = frappe.get_all(\n    \"Has Role\",\n    filters={\"role\": [\"in\", roles_to_notify]},\n    pluck=\"parent\"\n)\n\nusers = []\n\nif role_users:\n    # Remove disabled users\n    users = frappe.get_all(\n        \"User\",\n        filters={\n            \"name\": [\"in\", role_users],\n            \"enabled\": 1\n        },\n        pluck=\"name\"\n    )\n\nif users:\n    # Prepare field details (important fields only)\n    fields_data = []\n\n    fields_data.append(f\"<b>Supplier</b>: {doc.supplier}\")\n    fields_data.append(f\"<b>Posting Date</b>: {doc.posting_date}\")\n    fields_data.append(f\"<b>Grand Total</b>: {doc.grand_total}\")\n    fields_data.append(f\"<b>Status</b>: {doc.status}\")\n\n    message = f\"\"\"\n    <h4>Purchase Receipt Submitted</h4>\n    <hr>\n    {'<br>'.join(fields_data)}\n    <br><br>\n    <a href=\"/app/purchase-receipt/{doc.name}\">Open Purchase Receipt</a>\n    \"\"\"\n\n    # Create Bell Notifications\n    for user in users:\n        frappe.get_doc({\n            \"doctype\": \"Notification Log\",\n            \"subject\": f\"Purchase Receipt {doc.name} Submitted\",\n            \"email_content\": message,\n            \"for_user\": user,\n            \"document_type\": doc.doctype,\n            \"document_name\": doc.name,\n            \"type\": \"Alert\",\n            \"read\": 0\n        }).insert(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-24 13:22:58.589082",
  "module": "Stock",
  "name": "Create Quality Inspection After Stock entry Submit",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Stock Entry",
  "script": "QC_WAREHOUSES = (\n    \"RM Under Test Store - (A) - BS\",\n    \"RM Under Test Store - (B) - BS\",\n    \"RM Under Test Store - (C) - BS\",\n    \"PM Under Test Store - (A) - BS\",\n    \"PM Under Test Store - (B) - BS\",\n    \"PM Under Test Store - (C) - BS\",\n)\n\ndef get_batch_no_from_bundle(bundle):\n    if not bundle:\n        return None\n\n    return frappe.db.get_value(\n        \"Serial and Batch Entry\",\n        {\"parent\": bundle},\n        \"batch_no\"\n    )\n\ncreated = False\n\nfor item in doc.items:\n\n    target_warehouse = item.t_warehouse or doc.to_warehouse\n\n    frappe.log_error(\n        f\"Checking item {item.item_code} | Warehouse: {target_warehouse}\",\n        \"QC TRACE\"\n    )\n\n    if not target_warehouse or target_warehouse not in QC_WAREHOUSES:\n        continue\n\n    has_batch = frappe.db.get_value(\"Item\", item.item_code, \"has_batch_no\")\n    if not has_batch:\n        continue\n\n    batch_no = item.batch_no or get_batch_no_from_bundle(item.serial_and_batch_bundle)\n\n    if not batch_no:\n        frappe.throw(\n            f\"Batch No is mandatory for Quality Inspection. \"\n            f\"Please set Batch No for Item <b>{item.item_code}</b>\"\n        )\n\n    if frappe.db.exists(\n        \"Quality Inspection\",\n        {\n            \"reference_type\": \"Stock Entry\",\n            \"reference_name\": doc.name,\n            \"item_code\": item.item_code,\n            \"batch_no\": batch_no,\n        }\n    ):\n        continue\n\n    qi = frappe.get_doc({\n        \"doctype\": \"Quality Inspection\",\n        \"inspection_type\": \"Incoming\",\n        \"reference_type\": \"Stock Entry\",\n        \"reference_name\": doc.name,\n        \"item_code\": item.item_code,\n        \"batch_no\": batch_no,\n        \"sample_size\": 1,\n        \"company\": doc.company,\n        \"inspected_by\": frappe.session.user,\n    })\n\n    qi.insert(ignore_permissions=True)\n    created = True\n\nif not created:\n    frappe.log_error(\"No Quality Inspection created\", \"QC RESULT\")\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-02-26 14:30:08.005120",
  "module": "Manufacturing",
  "name": "Notification to Purchase Manager on Purchase Material Request",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "# Run only for Purchase Material Request\nif doc.material_request_type == \"Purchase\":\n\n    roles_to_notify = [\n        \"Purchase Master Manager\",\n        \"Purchase Manager\"\n    ]\n\n    # Get users having these roles\n    role_users = frappe.get_all(\n        \"Has Role\",\n        filters={\"role\": [\"in\", roles_to_notify]},\n        pluck=\"parent\"\n    )\n\n    users = []\n\n    if role_users:\n        # Remove disabled users\n        users = frappe.get_all(\n            \"User\",\n            filters={\n                \"name\": [\"in\", role_users],\n                \"enabled\": 1\n            },\n            pluck=\"name\"\n        )\n\n    if users:\n        # Prepare important field details\n        fields_data = []\n\n        fields_data.append(f\"<b>Material Request ID</b>: {doc.name}\")\n        fields_data.append(f\"<b>Company</b>: {doc.company}\")\n        fields_data.append(f\"<b>Requested By</b>: {doc.owner}\")\n        fields_data.append(f\"<b>Transaction Date</b>: {doc.transaction_date}\")\n        fields_data.append(f\"<b>Status</b>: {doc.status}\")\n\n        message = f\"\"\"\n        <h4>Purchase Material Request Submitted</h4>\n        <hr>\n        {'<br>'.join(fields_data)}\n        <br><br>\n        <a href=\"/app/material-request/{doc.name}\">Open Material Request</a>\n        \"\"\"\n\n        # Create Bell Notifications\n        for user in users:\n            frappe.get_doc({\n                \"doctype\": \"Notification Log\",\n                \"subject\": f\"Material Request {doc.name} Submitted\",\n                \"email_content\": message,\n                \"for_user\": user,\n                \"document_type\": doc.doctype,\n                \"document_name\": doc.name,\n                \"type\": \"Alert\",\n                \"read\": 0\n            }).insert(ignore_permissions=True)",
  "script_type": "DocType Event"
 }
]