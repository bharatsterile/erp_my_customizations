[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle In",
  "enabled": 1,
  "modified": "2026-02-24 14:34:48.969041",
  "module": "development",
  "name": "Open Print Format on Vehicle In Submit",
  "script": "frappe.ui.form.on('Vehicle In', {\n after_save: function(frm) {\n        frappe.utils.print(\n            frm.doctype,\n            frm.doc.name,\n            'Vehicle In Receipt'\n        );\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Visitor In",
  "enabled": 1,
  "modified": "2026-02-24 14:34:43.124134",
  "module": "development",
  "name": "Open Print Format on Visitor In",
  "script": "frappe.ui.form.on('Visitor In', {\n\tafter_save: function(frm) {\n        frappe.utils.print(\n            frm.doctype,\n            frm.doc.name,\n            'Visitor In Receipt'\n        );\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee In",
  "enabled": 1,
  "modified": "2026-02-24 14:34:35.454790",
  "module": "development",
  "name": "Open Print Format On Employee In",
  "script": "frappe.ui.form.on('Employee In', {\nafter_save: function(frm) {\n        frappe.utils.print(\n            frm.doctype,\n            frm.doc.name,\n            'Employee In Receipt'\n        );\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2026-02-25 13:09:04.032736",
  "module": "Stock",
  "name": "Material Request from Production Plan",
  "script": "frappe.ui.form.on('Material Request', {\n\trefresh: function(frm) {\n\n        // Check if created from Production Plan\n        if (frm.doc.production_plan) {\n\n            // Set only Purchase as option\n            frm.set_df_property('material_request_type', 'options', ['Purchase']);\n\n            // Force value to Purchase\n            frm.set_value('material_request_type', 'Purchase');\n\n            // Make field read-only\n            frm.set_df_property('material_request_type', 'read_only', 1);\n        }\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Production Plan",
  "enabled": 1,
  "modified": "2026-02-26 10:52:30.087363",
  "module": "Manufacturing",
  "name": "FG Items and FG warehouse in Assembly Items in Production Plan",
  "script": "frappe.ui.form.on('Production Plan', {\n    refresh: function(frm) {\n\n        // Filter Item in Assembly Items\n        frm.set_query('item_code', 'po_items', function(doc, cdt, cdn) {\n            return {\n                filters: {\n                    item_code: ['like', 'FG%']\n                }\n            };\n        });\n\n        // Filter Warehouse in Assembly Items\n        frm.set_query('warehouse', 'po_items', function(doc, cdt, cdn) {\n            return {\n                filters: {\n                    name: ['like', 'FG%']\n                }\n            };\n        });\n        \n        // Filter Sub Assembly Warehouse (Parent Field)\n        frm.set_query('sub_assembly_warehouse', function() {\n            return {\n                filters: {                     \n\t\t\t\t\tname: ['like', 'FG QUARANTINE%']\n                }\n            };\n        });\n\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2026-02-27 15:40:06.893305",
  "module": "Stock",
  "name": "Stock Entry rules for source and target warehouses",
  "script": "frappe.ui.form.on('Stock Entry', {\n\n    onload: function(frm) {\n        bind_parent_query(frm);\n        bind_target_query(frm);\n    },\n\n    refresh: function(frm) {\n        bind_parent_query(frm);\n        bind_target_query(frm);\n    },\n\n    from_warehouse: function(frm) {\n        frm.set_value(\"to_warehouse\", \"\");  // clear invalid\n        bind_parent_query(frm);\n        frm.refresh_field(\"items\");\n    },\n    \n    stock_entry_type: function(frm) {\n\n        //  Clear parent warehouses\n        frm.set_value(\"from_warehouse\", \"\");\n        frm.set_value(\"to_warehouse\", \"\");\n\n        // Clear child table completely\n         frm.clear_table(\"items\");\n\n        //⃣ Refresh fields\n        frm.refresh_field(\"from_warehouse\");\n        frm.refresh_field(\"to_warehouse\");\n        frm.refresh_field(\"items\");\n    }\n    \n});\n\n\nfrappe.ui.form.on('Stock Entry Detail', {\n\n    s_warehouse: function(frm, cdt, cdn) {\n        frm.refresh_field(\"items\");\n    },\n\n    items_add: function(frm) {\n        frm.refresh_field(\"items\");\n    }\n});\n\n\nfunction bind_target_query(frm) {\n\n    frm.set_query(\"t_warehouse\", \"items\", function(doc, cdt, cdn) {\n\n        let row = locals[cdt][cdn];\n        let entry_type = doc.stock_entry_type;  \n        let from_wh = row.s_warehouse || doc.from_warehouse;\n        if (!from_wh) return {};\n\n        let section = get_section(from_wh);\n        let store_type = get_store_type(from_wh);\n        let material_type = get_material_type(from_wh);\n\n        let filters = [];\n\n        // Always same section\n        if (section) {\n            filters.push([\"Warehouse\", \"name\", \"like\", \"%(\" + section + \")%\"]);\n        }\n\n        // ===== MOVEMENT RULES =====\n\n        if (store_type === \"RECEIVING\") {\n            filters.push([\"Warehouse\", \"name\", \"like\", \"%Under Test Store%\"]);\n        }\n\n        else if (store_type === \"UNDER_TEST\") {\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Approved Store - (\" + section + \") - BS\",\n                material_type + \" Reject Store - (\" + section + \") - BS\"\n            ]]);\n        }\n\n        else if (store_type === \"REJECT\") {\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Under Test Store - (\" + section + \") - BS\",\n                \"Receiving Store - (\" + section + \") - BS\"\n            ]]);\n        }\n\n        else if (store_type === \"WIP\") {\n            if(entry_type === \"Material Transfer\") {\n                \n                filters.push([\"Warehouse\", \"name\", \"in\", [\n                    \"RM Approved Store - (\" + section + \") - BS\",\n                    \"PM Approved Store - (\" + section + \") - BS\",\n                    \"RM Under Test Store - (\" + section + \") - BS\",\n                    \"PM Under Test Store - (\" + section + \") - BS\"\n                ]]);\n                \n            }\n            \n            //filters.push([\"Warehouse\", \"name\", \"like\", \"%Approved Store%\"]);\n            \n            \n        }\n\n        else if (store_type === \"APPROVED\") {\n        //    filters.push([\"Warehouse\", \"name\", \"like\", \"%\" + material_type + \"%\"]);\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Reject Store - (\" + section + \") - BS\",\n                material_type + \" Under Test Store - (\" + section + \") - BS\",\n                \"Receiving Store - (\" + section + \") - BS\"\n            ]]);\n        }\n\n        return { filters: filters };\n    });\n}\n\n\nfunction get_section(warehouse) {\n    if (!warehouse) return null;\n    if (warehouse.includes(\"(A)\")) return \"A\";\n    if (warehouse.includes(\"(B)\")) return \"B\";\n    if (warehouse.includes(\"(C)\")) return \"C\";\n    return null;\n}\n\nfunction get_store_type(warehouse) {\n    if (!warehouse) return null;\n\n    if (warehouse.includes(\"Receiving Store\")) return \"RECEIVING\";\n    if (warehouse.includes(\"Under Test Store\")) return \"UNDER_TEST\";\n    if (warehouse.includes(\"Approved Store\")) return \"APPROVED\";\n    if (warehouse.includes(\"Reject Store\")) return \"REJECT\";\n    if (warehouse.includes(\"Work In Progress\")) return \"WIP\";\n\n    return null;\n}\n\nfunction get_material_type(warehouse) {\n    if (!warehouse) return null;\n\n    if (warehouse.includes(\"RM\")) return \"RM\";\n    if (warehouse.includes(\"PM\")) return \"PM\";\n\n    return null;\n}\n\nfunction bind_parent_query(frm) {\n\n    frm.set_query(\"to_warehouse\", function(doc) {\n\n        let from_wh = doc.from_warehouse;\n        if (!from_wh) return {};\n        \n        let entry_type = doc.stock_entry_type;\n\n        let section = get_section(from_wh);\n        let store_type = get_store_type(from_wh);\n        let material_type = get_material_type(from_wh);\n\n        let filters = [];\n\n        // Always same section\n        if (section) {\n            filters.push([\"Warehouse\", \"name\", \"like\", \"%(\" + section + \")%\"]);\n        }\n\n        // =========================\n        // STRICT MATRIX RULES\n        // =========================\n\n        if (store_type === \"RECEIVING\") {\n            // Can go only to RM/PM Under Test of same section\n            filters.push([\"Warehouse\", \"name\", \"like\", \"%Under Test Store%\"]);\n        }\n\n        else if (store_type === \"UNDER_TEST\") {\n            // RM Under Test → RM Approved / RM Reject\n            // PM Under Test → PM Approved / PM Reject\n\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Approved Store - (\" + section + \") - BS\",\n                material_type + \" Reject Store - (\" + section + \") - BS\"\n            ]]);\n        }\n\n        else if (store_type === \"REJECT\") {\n            // Reject → Under Test OR Receiving (same section)\n\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Under Test Store - (\" + section + \") - BS\",\n                \"Receiving Store - (\" + section + \") - BS\"\n            ]]);\n        }\n\n        else if (store_type === \"WIP\") {\n            // WIP → Approved of same material + section\n             if(entry_type === \"Material Transfer\") {\n                 \n                filters.push([\"Warehouse\", \"name\", \"in\", [\n                    \"RM Approved Store - (\" + section + \") - BS\",\n                    \"PM Approved Store - (\" + section + \") - BS\",\n                    \"RM Under Test Store - (\" + section + \") - BS\",\n                    \"PM Under Test Store - (\" + section + \") - BS\"\n                ]]); \n                \n             }\n              \n            //filters.push([\"Warehouse\", \"name\", \"like\", \"%Approved Store%\"]);\n        }\n\n        else if (store_type === \"APPROVED\") {\n            // Approved → Any RM store in same section\n           // filters.push([\"Warehouse\", \"name\", \"like\", \"%\" + material_type + \"%\"]);\n            filters.push([\"Warehouse\", \"name\", \"in\", [\n                material_type + \" Reject Store - (\" + section + \") - BS\",\n                material_type + \" Under Test Store - (\" + section + \") - BS\",\n                \"Receiving Store - (\" + section + \") - BS\"\n            ]]); \n        }\n\n        return { filters: filters };\n    });\n}",
  "view": "Form"
 }
]